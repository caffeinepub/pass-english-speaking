{
  "kind": "implementation_plan",
  "version": "1.0",
  "title": "English Learning Companion: non-repetitive, context-aware chat with Hindi/Hinglish support",
  "requirements": [
    {
      "id": "REQ-1",
      "summary": "Remove repetitive fallback chat templates and ensure short messages/questions trigger varied, useful replies instead of generic â€œtell me moreâ€ prompts.",
      "acceptanceCriteria": [
        "In Friend Chat, sending multiple short messages (e.g., â€œOkâ€, â€œNiceâ€, â€œHmmâ€, â€œWhy?â€) results in varied, non-repetitive responses that are not all requests to â€œtell me moreâ€.",
        "Teacher mode responses are actionable/helpful (e.g., corrections, suggested phrasing, a clarifying question) rather than generic prompts.",
        "The exact phrase â€œCool! ğŸ˜ Can you tell me more about that?â€ is no longer used as the default catch-all for short messages."
      ],
      "file_operations": [
        {
          "path": "frontend/src/lib/friendTutor/generateTutorReply.ts",
          "operation": "modify",
          "description": "Replace generic question/short-message fallback templates with context-aware reply strategies (e.g., direct attempt at answering questions, topic-grounded follow-up prompts, and structured teacher responses) and remove the hardcoded repetitive phrase used for short messages."
        },
        {
          "path": "frontend/src/pages/FriendChatPage.tsx",
          "operation": "modify",
          "description": "Update chat reply selection so different personality modes produce different generators/behaviors (reducing repetition across messages) and adjust the initial tutor message copy to avoid reinforcing repetitive patterns."
        }
      ]
    },
    {
      "id": "REQ-2",
      "summary": "Update chat persona instructions so the assistant consistently identifies as an English Learning Companion and prioritizes English-learning help across modes.",
      "acceptanceCriteria": [
        "The assistantâ€™s self-description for â€œwho are you / what are youâ€ aligns with â€œEnglish Learning Companionâ€ (not generic â€œAI Friend/Chat Assistantâ€).",
        "Across Friend/Teacher/AI modes, replies consistently focus on English learning (e.g., improved sentence suggestions, grammar tips, vocabulary alternatives) when applicable."
      ],
      "file_operations": [
        {
          "path": "frontend/src/lib/friendTutor/persona.ts",
          "operation": "create",
          "description": "Add centralized persona/system-style instruction constants for the â€œEnglish Learning Companionâ€, including per-mode tone guidance (Friend vs Teacher vs AI) that prioritizes English-learning outcomes over filler conversation."
        },
        {
          "path": "frontend/src/lib/friendTutor/generateTutorReply.ts",
          "operation": "modify",
          "description": "Use the new English Learning Companion persona guidance for self-identity replies (e.g., â€œwho are youâ€) and for mode-specific prioritization (corrections, examples, vocabulary upgrades) rather than generic chat-assistant phrasing."
        },
        {
          "path": "frontend/src/lib/friendTutor/generatePowerTutorReply.ts",
          "operation": "modify",
          "description": "Align Power/AI-mode identity text and coaching style with the â€œEnglish Learning Companionâ€ persona and ensure responses consistently include English-learning help when applicable."
        },
        {
          "path": "frontend/src/pages/FriendChatPage.tsx",
          "operation": "modify",
          "description": "Update visible labels/intro text in the Friend Chat page so the assistant is presented as an English Learning Companion (user-facing UI text stays English)."
        }
      ]
    },
    {
      "id": "REQ-3",
      "summary": "Improve context awareness so replies reference the userâ€™s message and provide a specific helpful next step (answer/correction/example/targeted follow-up).",
      "acceptanceCriteria": [
        "When the user asks a direct question (message contains â€œ?â€), the assistant attempts a direct helpful response first (or asks a targeted clarifying question tied to the userâ€™s topic), rather than replying with a generic â€œtell me moreâ€ prompt.",
        "When the user provides a short statement (<= 3 words), the assistant responds with a helpful expansion prompt that uses the userâ€™s topic (e.g., asking for one concrete detail, offering an example sentence), not a generic filler line.",
        "At least one part of the assistant reply (in all modes) is clearly grounded in the userâ€™s message (e.g., repeats a key noun/verb, proposes a corrected version of what the user wrote, or gives a relevant example)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/lib/friendTutor/replyStrategy.ts",
          "operation": "create",
          "description": "Add lightweight local helpers for context grounding (e.g., extracting a simple topic keyword/phrase from the user message, detecting whether itâ€™s a direct question, and choosing an appropriate next-step action such as answer/correction/example/targeted follow-up)."
        },
        {
          "path": "frontend/src/lib/friendTutor/generateTutorReply.ts",
          "operation": "modify",
          "description": "Integrate the new context-grounding helpers to ensure every reply includes at least one message-grounded element (topic echo, corrected rewrite, or relevant example) and that questions are handled with a direct attempt or targeted clarification."
        },
        {
          "path": "frontend/src/lib/friendTutor/analyzeUserMessage.ts",
          "operation": "modify",
          "description": "Extend local analysis to expose minimal signals needed for context-aware replies (e.g., question/short-message flags or a basic extracted topic) so reply generation can reliably ground responses in the userâ€™s content."
        }
      ]
    },
    {
      "id": "REQ-4",
      "summary": "Detect Hindi/Hinglish input and respond in a blended Hindi+English style while still supporting English learning goals.",
      "acceptanceCriteria": [
        "If the user message contains Devanagari text and/or common Hinglish patterns (e.g., â€œTum kaun hoâ€, â€œMujhe help chahiyeâ€), the assistant responds with a blended Hindi+English explanation (not English-only).",
        "For the specific example â€œTum kaun hoâ€, the assistant answers who it is in mixed Hindi+English and includes an English-learning element (e.g., giving the English translation and a natural English alternative like â€œWho are you?â€ / â€œWho are you, exactly?â€).",
        "If the user message is clearly English-only, the assistant responds in English (no unnecessary Hindi mixing)."
      ],
      "file_operations": [
        {
          "path": "frontend/src/lib/friendTutor/languageDetection.ts",
          "operation": "create",
          "description": "Add local Hindi/Hinglish detection utilities (e.g., Devanagari detection plus common romanized Hindi patterns) to decide when the assistant should use a blended Hindi+English teaching style."
        },
        {
          "path": "frontend/src/lib/friendTutor/generateTutorReply.ts",
          "operation": "modify",
          "description": "Incorporate Hindi/Hinglish detection to switch response style to mixed Hindi+English only when triggered, including a dedicated handling for â€œTum kaun hoâ€ that provides identity + English translation + a natural English alternative."
        },
        {
          "path": "frontend/src/lib/friendTutor/generatePowerTutorReply.ts",
          "operation": "modify",
          "description": "Apply the same Hindi/Hinglish detection behavior in Power/AI-mode replies so language switching remains consistent across modes when the user writes in Hindi/Hinglish."
        }
      ]
    },
    {
      "id": "REQ-5",
      "summary": "Make Friend vs Teacher personality modes clearly distinct in tone and structure while avoiding repetitive templates across messages.",
      "acceptanceCriteria": [
        "Friend mode replies include light humor/playfulness without becoming repetitive, while still staying focused on English practice.",
        "Teacher mode replies follow a consistent helpful structure (e.g., brief answer or correction + short explanation + 1 example), rather than generic conversation fillers.",
        "Switching between Friend and Teacher for the same user message produces noticeably different tone and structure."
      ],
      "file_operations": [
        {
          "path": "frontend/src/lib/friendTutor/persona.ts",
          "operation": "modify",
          "description": "Define distinct per-mode style rules: Friend mode (light, playful humor + quick practice prompt) vs Teacher mode (structured correction/explanation/example) while keeping the shared â€œEnglish Learning Companionâ€ identity."
        },
        {
          "path": "frontend/src/lib/friendTutor/generateTutorReply.ts",
          "operation": "modify",
          "description": "Refactor mode handling so Friend mode produces playful, varied practice-focused replies and Teacher mode produces a consistent structured teaching response (correction/suggestion + short explanation + example + targeted question), minimizing reuse of the same templates across turns."
        },
        {
          "path": "frontend/src/pages/FriendChatPage.tsx",
          "operation": "modify",
          "description": "Ensure mode switching in the UI results in clearly different reply behavior for the same input (Friend vs Teacher), while keeping all UI strings added/modified in English."
        }
      ]
    }
  ]
}